@model List<HulubejeBooking.Models.BusModels.PassengerModel>

<partial name="_Navigation" />
<head>
    <title>Confirmation</title>
</head>
<div class="container mt-4">
    @{
        string formattedArrivalTime = ViewBag.ArrivalDate.ToString("h:mm tt");
        string formattedDepartTime = ViewBag.DepartureDate.ToString("h:mm tt");
    }
    <div class="row border rounded mb-4 pt-3 bg-dark">
        <div class="col-md-4 text-center">
            <div class="row">
                <div class="col-3 d-flex justify-content-end align-items-center">
                    <p><span style="color: white;"><i class="fas fa-bus fa-3x ml-2"></i></span></p>
                </div>
                <div class="col-9">
                    <h5 class="text-primary mb-0">@ViewBag.OperatorName</h5>
                    <p class="mb-0" style="color: white"><small>@ViewBag.PlateNumber</small></p>
                    <p class="font-weight-bold mb-0" style="color: white">@ViewBag.Date</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <div class="row"> 
                <div class="row">
                    <div class="col-3">
                        <p><span style="color: white;"><i class="fas fa-map-marker-alt fa-2x ml-2 mt-2"></i></span></p>
                    </div>
                    <div class="col-9">
                        <h6 class="text-success mb-0">Departure</h6>
                        <p class="mb-0" style="color: white">@ViewBag.DepatureCity</p>
                        @if (DateTime.TryParse(formattedDepartTime, out DateTime utcDepartTime))
                        {
                            DateTime ethiopianTime = utcDepartTime.ToString("tt").Equals("AM") ? utcDepartTime.AddHours(6) : utcDepartTime.AddHours(-6);
                            <p class="font-weight-bold mb-0" style="color: white">@formattedDepartTime (@ethiopianTime.ToString("h.mm tt") LT)</p>
                        }
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <div class="row">
                <div class="col-3 d-flex justify-content-end align-items-center">
                    <p><span style="color: white;"><i class="fas fa-arrow-right fa-4x ml-2"></i></span></p>
                </div>
                <div class="col-9">
                    <h6 class="text-danger mb-0">Arrival</h6>
                    <p class="mb-0" style="color: white">@ViewBag.DestinationCity</p>
                    @if (DateTime.TryParse(formattedArrivalTime, out DateTime utcArrivalTime))
                    {
                        DateTime ethiopianArrivalTime = utcArrivalTime.ToString("tt").Equals("AM") ? utcArrivalTime.AddHours(6) : utcArrivalTime.AddHours(-6);
                        <p class="font-weight-bold mb-0" style="color: white">@formattedArrivalTime (@ethiopianArrivalTime.ToString("h.mm tt") LT)</p>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="header text-center text-dark py-3">
        <h3 class="mb-0"><i class="fas fa-user-friends  mr-2"></i> Passengers</h3>
    </div>
    <div class="row pt-3 mb-3 bg-light">
        @{
            var count = 1;
        }
        @foreach (var passenger in Model)
        {

            <div class="mb-4">
                <div class="card border-primary h-100 p-2">
                    <div class="card-body ">
                        <div style=""> 
                            <h5 class="card-title text-primary">@passenger.PassengerName</h5>
                        </div>
                        <hr>
                        <div class="row p-2" style="background-color: #e0b300; border-radius: 5px;">
                            <div class="col-md-4 ">
                                <p class="card-text mb-0"><strong>Age</strong>  <span class="float-right">@passenger.PassengerAge</span></p>
                                <p class="card-text mb-0"><strong>Nationality:</strong>  <span class="float-right">@passenger.Nationality</span></p>
                            </div>
                            <div class="col-md-4" id="passenger-@count">
                                <p class="card-text mb-0"><strong>Gender:</strong>  <span class="float-right">@passenger.Gender</span></p>
                                <p class="card-text mb-0"><strong>Phone Number:</strong>  <span class="float-right " >@passenger.PhoneNumber </span></p>
                            </div>
                            <div class="col-md-4">
                                <p class="card-text mb-0"><strong>ID Number </strong>  <span class="float-right">@passenger.PassengerId</span></p>
                                @if (passenger.Email is not null)
                                {
                                    <p class="card-text mb-0"><strong>Email:</strong>  <span class="float-right">@passenger.Email</span></p>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            count += 1;
        }
    </div>
    <div style="display: flex;
            justify-content: center;
            align-items: center;">
        <button type="submit" id="confirmButton" class="btn btn-success mb-2">Confirm</button>

    </div>
</div>
<partial name="_Footer" />
<script>
    var Tarrif = "@ViewBag.Tariff";
    var index = Tarrif.indexOf(' ');
    var result = (index > 0) ? Tarrif.substring(0, index) : Tarrif;
    var passengerId = '#passenger-1';
    var userMobileNumber = $(passengerId + ' .float-right').eq(1).text();
    console.log("userMobileNumber: " + userMobileNumber);

    $('#confirmButton').on('click', function () {
        var data = {
            AuthorizePaymentData: {
                UserMobileNumber: userMobileNumber,
                SupplierTin: '0058055734',
                SupplierOUD: 'OUD000000049',
                Amount: result
            },
        };
        console.log("data" ,data)
        $.ajax({
            url: '/PaymentHome/Index',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (/* response */) {
                window.location.href = "/PaymentOptions/PaymentOption";
            },
            error: function (error) {
                console.error('Error:', error);  
            }
        });
    });
</script>