@using System.Globalization
@{
    var isVaild = ViewBag.isVaild;
    var isLoggedIN = ViewBag.isLoggedIn;
}
<script>
    sessionStorage.setItem("isValid", @Json.Serialize(@isVaild));
    sessionStorage.setItem("isLoggedIn", @Json.Serialize(@isLoggedIN));
</script>
<partial name="_Navigation" />
@model HulubejeBooking.Models.HotelModels.GetHotelByCity
@{
    double? maxTotalPrice = Model?.Data != null ? Model.Data.Max(hotel => hotel.TotalPrice) : 0;
    double? minTotalPrice = Model?.Data != null ? Model.Data.Min(hotel => hotel.TotalPrice) : 0;
}
<title>Hotel List</title>
<style>
    .search-container {

        display: flex;
        align-items: center;
        justify-content: flex-end; 
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
        border: 1px solid #ccc;
        border-radius: 20px;
        overflow: hidden;
        transition: width 0.3s ease-in-out;
    }

    .search-input {
        flex: 1;
        border: none;
        padding: 10px;
        font-size: 16px;
        outline: none;
    }

    .search-button {
        background-color: #007bff;
        border: none;
        padding: 10px;
        color: #fff;
        cursor: pointer;
        transition: background-color 0.3s ease-in-out;
    }

        .search-button:hover {
            background-color: #0056b3;
        }
    h4 {
        font-size: 18px;
        font-weight: 500;
        color: #000;
        margin-bottom: 20px;
        text-align: center;
    }

    .price-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 0 10px;
    }

    label {
        font-size: 14px;
        font-weight: 500;
    }

    p {
        font-size: 16px;
        font-weight: 600;
    }

    .range-slider {
        position: relative;
        margin-top: 10px;
    }

    .range-fill {
        height: 4px;
        background-color: #063970;
        position: absolute;
        z-index: 1;
    }

    input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
        position: absolute;
        left: 0;
    }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 15px;
            width: 15px;
            border-radius: 50%;
            background: #063970;
            cursor: pointer;
            margin-top: -5px;
            position: relative;
            z-index: 1;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 5px;
            background: #e8e8e8;
            border-radius: 3px;
            border: none;
        }

    .range-fill {
        position: absolute;
        height: 10px;
        background-color: #063970;
        border-radius: 5px;
    }
</style>
<body class="bg-light">
    <div class="container">

        <div class="row my-3 mx-1" style="padding-bottom:10px;">
            <div class="col-lg-4">
                <div class="d-lg-none">
                    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="false" aria-controls="filtersCollapse">
                        <span class="bi bi-filter"></span> Filters
                    </button>
                </div>
                <div class="collapse d-lg-block" id="filtersCollapse">
                    <div class="row mx-sm-0 mx-2" style="padding-right: 0px; padding-left:0px;">
                        <form>
                            <fieldset>
                                <div class="row">
                                    <legend>Filter by Amenities</legend>

                                    <div class=" col-md-6 hotelAmenities border bg-white mb-sm-0 mb-2">

                                        <label><strong>Hotel Amenities</strong></label>
                                        <div>
                                            <input type="checkbox" id="buisnessCenter" name="hotelAmenities" value="Business center">
                                            <label for="buisnessCenter">Business Center</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="gym" name="hotelAmenities" value="Gym">
                                            <label for="gym">Gym</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="conferenceFacilities" name="hotelAmenities" value="Conference facilities">
                                            <label for="conferenceFacilities">Conference Facilities</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="parking" name="hotelAmenities" value="Parking">
                                            <label for="parking">Parking</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="restaurantBar" name="hotelAmenities" value="Restaurant & Bar">
                                            <label for="restaurantBar">Restaurant & Bar</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="roomService" name="hotelAmenities" value="Room Service">
                                            <label for="roomService">Room Service</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="spa" name="hotelAmenities" value="Spa">
                                            <label for="spa">Spa</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="elevator" name="hotelAmenities" value="Elevator">
                                            <label for="elevator">Elevator</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="laundry" name="hotelAmenities" value="Laundry">
                                            <label for="laundry">Laundry</label>
                                        </div>
                                    </div>
                                    <div class=" col-md-6 roomAmenities  border bg-white">

                                        <label><strong>Room Amenities</strong></label>
                                        <div>
                                            <input type="checkbox" id="charging" name="roomAmenities" value="Charging">
                                            <label for="charging">Charging</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="doubleBed" name="roomAmenities" value="Double Bed">
                                            <label for="doubleBed">Double Bed</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="freeBottledWater" name="roomAmenities" value="Free Bottled Water">
                                            <label for="freeBottledWater">Free Bottled Water</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="guestChair" name="roomAmenities" value="Guest chair">
                                            <label for="guestChair">Guest Chair</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="miniBar" name="roomAmenities" value="Mini Bar">
                                            <label for="miniBar">Mini Bar</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="safebox" name="roomAmenities" value="Safe Box">
                                            <label for="safebox">Safebox</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="satelliteTV" name="roomAmenities" value="Satelite TV">
                                            <label for="satelliteTV">Satellite TV</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="showerBox" name="roomAmenities" value="Shower Box">
                                            <label for="showerBox">Shower Box</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="singleBed" name="roomAmenities" value="Single Bed">
                                            <label for="singleBed">Single Bed</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="slippersAndTowels" name="roomAmenities" value="Slippers & Towls">
                                            <label for="slippersAndTowels">Slippers and Towels</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="telephone" name="roomAmenities" value="Telephone">
                                            <label for="telephone">Telephone</label>
                                        </div>

                                        <div>
                                            <input type="checkbox" id="wifi" name="roomAmenities" value="WIFI">
                                            <label for="wifi">WiFi</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="airConditioner" name="roomAmenities" value="Air conditioner">
                                            <label for="airConditioner">Air Conditioner</label>
                                        </div>

                                        <div>
                                            <input type="checkbox" id="coffeeMaker" name="roomAmenities" value="Coffee Maker">
                                            <label for="coffeeMaker">Coffee Maker</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="livingArea" name="roomAmenities" value="Living Area">
                                            <label for="livingArea">Living Area</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="bathTub" name="roomAmenities" value="Bath tab">
                                            <label for="bathTub">Bath Tub</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="hairDryer" name="roomAmenities" value="Hair drier">
                                            <label for="hairDryer">Hair Dryer</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="workingDesk" name="roomAmenities" value="Working desk">
                                            <label for="workingDesk">Working Desk</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="balcony" name="roomAmenities" value="Balcony">
                                            <label for="balcony">Balcony</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="toothpasteAndBrush" name="roomAmenities" value="Toothpaste & Brush">
                                            <label for="toothpasteAndBrush">Toothpaste and Brush</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="bedNet" name="roomAmenities" value="Bed net">
                                            <label for="bedNet">Bed Net</label>
                                        </div>


                                    </div>
                                </div>

                            </fieldset>
                            <div class="row pb-4 my-2 cardPrice pt-2 px-md-4 px-3 border-lg-start border bg-white text-center">
                                <legend>Filter By Price</legend>
                                <div class="price-content">
                                    <div>
                                        <label for="filter-min-value">Min</label>
                                        <p id="min-value" style="font-size: 12px;">ETB 0</p>
                                    </div>
                                    <div>
                                        <label for="filter-max-value">Max</label>
                                        <p id="max-value" style="font-size: 12px;">ETB 0</p>
                                    </div>
                                </div>

                                <div class="range-slider">
                                    <div class="range-fill"></div>
                                    <!-- Inputs without initial values -->
                                    <input id="filter-min-value" type="range" class="min-price" min="0" step="50" />
                                    <input id="filter-max-value" type="range" class="max-price" min="0" step="50" />
                                </div>
                            </div>
                            <div class="row  mb-2 filter pt-2 border bg-white">
                                <legend class="text-center">Sort</legend>
                                <div class="col-md-6">
                                    <div>
                                        <input type="checkbox" id="defaultFilter" name="sort" checked>
                                        <label for="defaultFilter">Default</label>
                                    </div>
                                    <div>
                                        <input type="checkbox" id="sortByNameAZ" name="sort" value=" ">
                                        <label for="sortByNameAZ">Name: A - Z</label>
                                    </div>
                                    <div>
                                        <input type="checkbox" id="sortByNameZA" name="sort" value=" ">
                                        <label for="sortByNameZA">Name: Z - A</label>
                                    </div>
                                    <div>
                                        <input type="checkbox" id="sortDecresingStar" name="sort" value=" ">
                                        <label for="sortDecresingStar">Star: High to Low</label>
                                    </div><div>
                                        <input type="checkbox" id="sortIncresingStar" name="sort" value=" ">
                                        <label for="sortIncresingStar">Star: Low to High</label>
                                    </div>
                                </div>
                                <div class="col-md-6" style="padding-left: 0px !important">
                                    <div style="white-space: nowrap">
                                        <input type="checkbox" id="lowToHighFilter" name="sort">
                                        <label for="lowToHighFilter">Price: Low To High</label>
                                    </div>
                                    <div style="white-space: nowrap">
                                        <input type="checkbox" id="highToLowFilter" name="sort">
                                        <label for="highToLowFilter">Price: High To Low</label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-8 hotelsContainer" id="hotelContainer">
                <div class="search-container mt-2">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search Hotels by Name" style="font-size: 14px;">
                    <button class="search-button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                @if (Model?.Data?.Count > 0)
                {
                    var count = 0;
                    @foreach (var hotel in Model.Data)
                    {
                        count += 1;
                        <div class="cardH hotelCards card w-100 mt-3"
                             data-hotel-ratings="@hotel?.HotelRating"
                             data-hotel-name="@hotel?.OrganizationName"
                             data-original-count="@count"
                             data-hotel-price="@hotel?.TotalPrice"
                             data-hotel-amenities="@string.Join(",", hotel?.RoomAminities ?? Enumerable.Empty<string>())"
                             data-room-amenities="@string.Join(",", hotel?.HotelAminities ?? Enumerable.Empty<string>())"
                             data-min-room-value="@hotel?.MinRoomValue"
                             data-tin="@hotel?.OrgTin" data-oud="@hotel?.BranchCode"
                             data-hotelRating="@hotel?.HotelRating">
                            <div class="row">
                                <div class="col-sm-4">
                                    <img src="@hotel?.PortraitPicture" class="img-fluid rounded-start" alt="..." style="height:300px; width:300px;">
                                </div>
                                <div class="col-sm-8">


                                    <div class="card-body">
                                        <div class="row align-items-start ">
                                            <div class="col">
                                                <a href="#"><h5 class="card-title">@hotel?.OrganizationName</h5></a>
                                                @{
                                                    var dynamicRating = string.IsNullOrEmpty(hotel?.HotelRating?.ToString())
                                                    ? 0
                                                    : (int)Math.Round(double.Parse(hotel.HotelRating.ToString() ?? "0", CultureInfo.InvariantCulture));
                                                }

                                                @for (var i = 0; i < dynamicRating; i++)
                                                {
                                                    <i class="bi bi-star-fill text-warning" ></i>
                                                }

                                                @for (var j = dynamicRating; j < 5; j++)
                                                {
                                                    <i class="bi bi-star text-primary"></i>
                                                }
                                                <p class="card-text"><small class="text-body-secondary">@hotel?.BranchName</small></p>
                                                <div>
                                                    <span><i class="bi bi-geo-alt-fill"></i> @hotel?.SpecificLocation</span>
                                                </div>
                                                <div>
                                                    <span class="p-1 rounded" style="display: inline-block; background-color: green; color: white;">@hotel?.RateDescription</span>
                                                </div>
                                            </div>
                                            <span class="mt-2">
                                                <i class="bi bi-cash-stack"></i>Starting from: ETB @((hotel?.MinRoomValue ?? 0).ToString("N2", new System.Globalization.CultureInfo("am-ET")))
                                            </span>
                                            <div>
                                            </div>
                                            <div class="col-md-3">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="mt-2">
                                                    <div style="border-left: 1px solid black; padding-left: 8px;">
                                                        <span type="text" data-toggle="tooltip" data-placement="bottom" title="">
                                                            Type Of Rooms: @hotel?.HotelRoomsCount
                                                        </span>
                                                        <br>
                                                        <span type="text"
                                                              data-toggle="tooltip"
                                                              data-placement="bottom"
                                                              title=""
                                                              style="color: @(hotel?.IsTaxInclusive == true ? "green" : "red")">
                                                            @(hotel?.IsTaxInclusive == true ? "Tax Inclusive" : "Tax Exclusive")
                                                        </span>

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <h5>Total Price: ETB @string.Format(System.Globalization.CultureInfo.InvariantCulture, "{0:N2}", hotel?.TotalPrice ?? 0)</h5>
                                                <button class="btn btn-primary btn-sm viewAvailabilityBtn"
                                                        data-org-code="@hotel?.OrganizationCode"
                                                        data-cityname="@hotel?.CityName"
                                                        data-hotel="@hotel?.OrganizationName"
                                                        data-oud="@hotel?.BranchCode"
                                                        data-branch="@hotel?.BranchName">
                                                    View Availability
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="justify-content-center d-flex mt-3">
                        <h2>No Match!</h2>
                    </div>
                }
                <div class="d-flex justify-content-center mt-2" style="display: none;">
                    <!-- Add your loading spinner here -->
                    <div class="spinner-border text-primary" id="loadingSpinner" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


@* <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
@* <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" /> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> *@

<script>
    var minTotalPrice = @minTotalPrice;
    var maxTotalPrice = @maxTotalPrice;
    $(document).ready(function () {
        function filterHotelsByName() {
            var input, filter, cards, card, hotelName, i;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase().trimEnd();
            cards = document.querySelectorAll('.hotelCards');

            cards.forEach(function (card) {
                hotelName = card.getAttribute('data-hotel-name').toUpperCase();
                if (hotelName.indexOf(filter) > -1) {
                    card.style.display = "";
                } else {
                    card.style.display = "none";
                }
            });
        }
        $('.search-button').on('click', filterHotelsByName);
        $('#searchInput').on('keyup', filterHotelsByName);
    });

    function generateStarRatings(rating) {
        var dynamicRating = rating ? Math.round(parseFloat(rating)) : 0;
        var starsHtml = '';
        for (var i = 0; i < dynamicRating; i++) {
            starsHtml += '<i class="bi bi-star-fill text-warning"></i>';
        }
        for (var j = dynamicRating; j < 5; j++) {
            starsHtml += '<i class="bi bi-star text-primary"></i>';
        }
        return starsHtml;
    }
    var page = @Model?.HotelsCount;
    var currentPage = 2;
    var isLoading = false;
    var count = (currentPage -1 )* 5 + 1;
    function loadMoreHotels() {
        if (isLoading) return;
        if (currentPage > page * 2) {
            $('#loadingSpinner').hide();
            const roundedMinPrice = Math.floor(minTotalPrice / 1000) * 1000;
            const roundedMaxPrice = Math.ceil(maxTotalPrice / 1000) * 1000;
            filterByPrice(roundedMinPrice, roundedMaxPrice)
            return;
        }
        isLoading = true;
        $('#loadingSpinner').show();
        var data = {
            city: @Model?.RoomFormData?.city,
            roomsCount: @Model?.RoomFormData?.roomsCount,
            numberOfNights: @Model?.RoomFormData?.numberOfNights,
            childrenCount: @Model?.RoomFormData?.childrenCount,
            adultCount: @Model?.RoomFormData?.adultCount,
            dateRange: '@Model?.RoomFormData?.Date',
            page: currentPage,
        };
        $.ajax({
            url: '/hotel/AdditionalPages',
            type: 'GET',
            data: data,
            success: function (response) {
                const hotels = response.data;
                if (hotels && hotels.length > 0) {
                    const totalPrices = hotels.map(hotel => hotel.totalPrice);
                    const tempMaxTotalPrice = Math.max(...totalPrices);
                    const tempMinTotalPrice = Math.min(...totalPrices);

                    if (tempMaxTotalPrice > maxTotalPrice) {
                        maxTotalPrice = tempMaxTotalPrice;
                    }
                    if (tempMinTotalPrice < minTotalPrice) {
                        minTotalPrice = tempMinTotalPrice;
                    }
                }
                if (response != null && response.data != null) {
                    response.data.forEach(function (hotel) {
                        var stars = generateStarRatings(hotel.hotelRating);
                        var hotelHtml = `
                            <div class="cardH hotelCards card w-100 mt-3"
                                    data-hotel-ratings="${hotel.hotelRating}"
                                    data-hotel-name="${hotel.organizationName}"
                                    data-original-count="${count}"
                                    data-hotel-price="${hotel.totalPrice}"
                                    data-hotel-amenities="${hotel.roomAminities.join(',')}"
                                    data-room-amenities="${hotel.hotelAminities.join(',')}"
                                    data-min-room-value="${hotel.minRoomValue}"
                                    data-tin="${hotel.orgTin}" data-oud="${hotel.branchCode}"
                                    data-hotelRating="${hotel.hotelRating}">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <img src="${hotel.portraitPicture}" class="img-fluid rounded-start" alt="..." style="height:300px; width:300px;">
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="card-body">
                                            <a href="#"><h5 class="card-title">${hotel.organizationName}</h5></a>
                                            ${stars}
                                            <p class="card-text"><small class="text-body-secondary">${hotel.branchName}</small></p>
                                            <div>
                                                <span><i class="bi bi-geo-alt-fill"></i> ${hotel.specificLocation}</span>
                                            </div>
                                            <div>
                                                <span class="p-1 rounded" style="display: inline-block; background-color: green; color: white;">${hotel.rateDescription}</span>
                                            </div>
                                            <span class="mt-2">
                                                <i class="bi bi-cash-stack"></i> Starting from: ETB ${hotel.minRoomValue}
                                            </span>
                                            <!-- Add more details here as needed -->
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="mt-2">
                                                        <div style="border-left: 1px solid black; padding-left: 8px;">
                                                            <span type="text" data-toggle="tooltip" data-placement="bottom" title="">
                                                                Type Of Rooms: ${hotel.hotelRoomsCount}
                                                            </span>
                                                            <br>
                                                            <span type="text"
                                                                    data-toggle="tooltip"
                                                                    data-placement="bottom"
                                                                    title=""
                                                                    style="color: ${hotel.isTaxInclusive ? 'green' : 'red'}">
                                                                ${hotel.isTaxInclusive ? 'Tax Inclusive' : 'Tax Exclusive'}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <h5>Total Price: ETB ${hotel.totalPrice.toFixed(2)}</h5>
                                                    <button class="btn btn-primary btn-sm viewAvailabilityBtn"
                                                            data-org-code="${hotel.organizationCode}"
                                                            data-cityname="${hotel.cityName}"
                                                            data-hotel="${hotel.organizationName}"
                                                            data-oud="${hotel.branchCode}"
                                                            data-branch="${hotel.branchName}">
                                                        View Availability
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        $('#hotelContainer').append(hotelHtml);
                        count++;
                    });
                    currentPage++;
                }
                isLoading = false;
                loadMoreHotels();
                $('#loadingSpinner').hide();
            },
            error: function () {
                isLoading = false;
                $('#loadingSpinner').hide();
            }
        });
        function filterByPrice(minTotalPrice, maxTotalPrice) {
            // Update range sliders and displayed values
            const minPriceInput = document.getElementById('filter-min-value');
            const maxPriceInput = document.getElementById('filter-max-value');
            const minValueDisplay = document.getElementById('min-value');
            const maxValueDisplay = document.getElementById('max-value');

            // Set the min, max, and value attributes for the range sliders
            minPriceInput.min = minTotalPrice;
            minPriceInput.max = maxTotalPrice;
            minPriceInput.value = minTotalPrice;

            maxPriceInput.min = minTotalPrice;
            maxPriceInput.max = maxTotalPrice;
            maxPriceInput.value = maxTotalPrice;

            // Update the displayed min and max values
            minValueDisplay.textContent = `ETB ${minTotalPrice}`;
            maxValueDisplay.textContent = `ETB ${maxTotalPrice}`;

            // Add event listeners to update the displayed values when the slider is moved
            minPriceInput.addEventListener('input', function () {
                minValueDisplay.textContent = `ETB ${minPriceInput.value}`;
            });

            maxPriceInput.addEventListener('input', function () {
                maxValueDisplay.textContent = `ETB ${maxPriceInput.value}`;
            });
        }
    }
    $(document).ready(function () {
        loadMoreHotels();
        function sortByLowToHigh() {
            var hotels = $(".hotelCards").toArray();
            hotels.sort(function (a, b) {
                return parseFloat($(a).data("hotel-price")) - parseFloat($(b).data("hotel-price"));
            });
            $(".hotelsContainer").empty().append(hotels);
        }
        function sortByNameZA() {
            var hotels = $(".hotelCards").toArray();
            hotels.sort(function (a, b) {
                var nameA = $(a).data("hotel-name").toUpperCase();
                var nameB = $(b).data("hotel-name").toUpperCase();
                return nameB.localeCompare(nameA);
            });
            $(".hotelsContainer").empty().append(hotels);
        }

        function sortByNameAZ() {
            var hotels = $(".hotelCards").toArray();
            hotels.sort(function (a, b) {
                var nameA = $(a).data("hotel-name").toUpperCase();
                var nameB = $(b).data("hotel-name").toUpperCase();
                return nameA.localeCompare(nameB);
            });
            $(".hotelsContainer").empty().append(hotels);
        }
        function sortIncreasingStar (){
            var hotels = $(".hotelCards").toArray();
            hotels.sort(function (a, b) {
                return parseFloat($(a).data("hotel-ratings")) - parseFloat($(b).data("hotel-ratings"));
            });
            $(".hotelsContainer").empty().append(hotels);
        }
        function sortDecreasingStar() {
            var hotels = $(".hotelCards").toArray();
            hotels.sort(function (a, b) {
                return parseFloat($(b).data("hotel-ratings")) - parseFloat($(a).data("hotel-ratings"));
            });
            $(".hotelsContainer").empty().append(hotels);
        }
        function sortByHighToLow() {
            var hotels = $(".hotelCards").toArray();
            hotels.sort(function (a, b) {
                return parseFloat($(b).data("hotel-price")) - parseFloat($(a).data("hotel-price"));
            });
            $(".hotelsContainer").empty().append(hotels);
        }

        function resetToDefault() {
            var hotels = $(".hotelCards").toArray();
            hotels.sort(function (a, b) {
                return parseFloat($(a).data("original-count")) - parseFloat($(b).data("original-count"));
            });
            $(".hotelsContainer").empty().append(hotels);
        }

        $("#defaultFilter").change();

        $("#lowToHighFilter").change(function () {
            if ($(this).is(":checked")) {
                sortByLowToHigh();

            }
            else {
                resetToDefault();
            }
        });

        $("#highToLowFilter").change(function () {
            if ($(this).is(":checked")) {
                sortByHighToLow();
            } else {
                resetToDefault();
            }
        });
        $("#sortDecresingStar").change(function () {
            if ($(this).is(":checked")) {
                sortDecreasingStar();
            } else {
                resetToDefault();
            }
        });
        $("#sortIncresingStar").change(function () {
            if ($(this).is(":checked")) {
                sortIncreasingStar();
            } else {
                resetToDefault();
            }
        });
        $("#sortByNameAZ").change(function () {
            if ($(this).is(":checked")) {
                sortByNameAZ();
            } else {
                resetToDefault();
            }
        });
        $("#sortByNameZA").change(function () {
            if ($(this).is(":checked")) {
                sortByNameZA();
            } else {
                resetToDefault();
            }
        });
        $("#defaultFilter").change(function () {
            if ($(this).is(":checked")) {
                resetToDefault();
            }
        });
        $('[data-toggle="tooltip"]').tooltip();

        const $minPriceInput = $('#filter-min-value');
        const $maxPriceInput = $('#filter-max-value');
        const $minValueDisplay = $('#min-value');
        const $maxValueDisplay = $('#max-value');

        $minPriceInput.on('input', function () {
            const minPrice = parseFloat($minPriceInput.val());
            const maxPrice = parseFloat($maxPriceInput.val());
            $minValueDisplay.text(`ETB ${minPrice}`);
            filterHotelsByPrice(minPrice, maxPrice);
        });

        $maxPriceInput.on('input', function () {
            const minPrice = parseFloat($minPriceInput.val());
            const maxPrice = parseFloat($maxPriceInput.val());
            $maxValueDisplay.text(`ETB ${maxPrice}`);
            filterHotelsByPrice(minPrice, maxPrice);
        });
        function filterHotelsByPrice(minPrice, maxPrice) {
            $('.hotelCards').each(function () {
                const hotelPrice = parseFloat($(this).data('hotel-price'));

                if (hotelPrice >= minPrice && hotelPrice <= maxPrice) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }

    });

    $(document).ready(function () {
        $(".hotelsContainer").on("click", ".viewAvailabilityBtn", function () {
            var orgCode = $(this).data('org-code');
            var oud = $(this).data('oud');
            var cityName = $(this).data('cityname');
            var hotelName = $(this).data('hotel');
            var dateRange = '@Model?.RoomFormData?.Date';
            var dateParts = dateRange.split(' - ');

            var arrivalDate = new Date(Date.parse(dateParts[0]));
            var departureDate = new Date(Date.parse(dateParts[1]));

            function calculateNumberOfNights(arrivalDate, departureDate) {
                var timeDifference = departureDate.getTime() - arrivalDate.getTime();
                var numberOfNights = Math.round(timeDifference / (1000 * 3600 * 24));
                return numberOfNights;
            }

            var numberOfNights = calculateNumberOfNights(arrivalDate, departureDate);
            var roomFormData = {
                Date: '@Model?.RoomFormData?.Date',
                adultCount: parseInt('@Model?.RoomFormData?.adultCount'),
                childrenCount: parseInt('@Model?.RoomFormData?.adultCount'),
                roomsCount: parseInt('@Model?.RoomFormData?.adultCount'),
                orgCode: orgCode,
                cityName: cityName,
                oud: oud,
                Name: hotelName,
                numberOfNights: numberOfNights,
                branchName: $(this).data('branch'),
            };
            $.ajax({
                url: '../Hotel/Availability',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(roomFormData),
                success: function () {
                    window.location.href = '../rooms';
                },
                error: function (error) {
                    console.error('Error:', error);
                }
            });
        });
    });

    $(document).ready(function () {
        $(document).on('change', '.filter input[type="checkbox"]', function () {
            $('.filter input[type="checkbox"]').not(this).prop('checked', false);
        });
    });
</script>


<partial name="_Footer" />
